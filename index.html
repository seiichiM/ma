<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Group Manager</title>
    <style>
        body { font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif; max-width: 640px; margin: 2rem auto; padding: 0 1rem; background-color: #f4f6f9; color: #333; }
        .container { background: white; padding: 2.5rem; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        
        h1 { margin-top: 0; font-size: 1.4rem; color: #2c3e50; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #e9ecef; padding-bottom: 1rem; margin-bottom: 1.5rem; }
        
        label { display: block; margin-top: 1.2rem; font-weight: 600; font-size: 0.9rem; color: #495057; margin-bottom: 0.3rem; }
        select, input[type="text"] { width: 100%; padding: 0.7rem; border: 1px solid #ced4da; border-radius: 4px; box-sizing: border-box; font-size: 1rem; transition: border-color 0.15s; }
        select:focus, input:focus { border-color: #80bdff; outline: 0; box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25); }

        button { cursor: pointer; transition: all 0.2s; font-family: inherit; }
        
        .btn-outline { font-size: 0.85rem; padding: 0.4rem 0.8rem; background: transparent; border: 1px solid #6c757d; color: #6c757d; border-radius: 4px; }
        .btn-outline:hover { background: #6c757d; color: white; }

        .btn-primary { background: #007bff; color: white; border: none; padding: 0.7rem 1.2rem; border-radius: 4px; font-weight: 600; width: 100%; margin-top: 1rem; }
        .btn-primary:hover { background: #0056b3; }

        .btn-danger { background: #dc3545; color: white; border: none; padding: 0.3rem 0.6rem; border-radius: 3px; font-size: 0.8rem; }
        .btn-danger:hover { background: #c82333; }
        
        .btn-edit { background: #ffc107; color: #212529; border: none; padding: 0.3rem 0.6rem; border-radius: 3px; font-size: 0.8rem; margin-right: 0.4rem; }
        .btn-edit:hover { background: #e0a800; }

        .btn-file { background: #17a2b8; color: white; border: none; padding: 0.5rem 1rem; border-radius: 4px; font-size: 0.85rem; display: inline-flex; align-items: center; gap: 0.3rem; }
        .btn-file:hover { background: #138496; }
        
        .btn-export { background: #28a745; color: white; border: none; padding: 0.5rem 1rem; border-radius: 4px; font-size: 0.85rem; display: inline-flex; align-items: center; gap: 0.3rem; }
        .btn-export:hover { background: #218838; }

        .copy-group { display: flex; gap: 0.5rem; align-items: flex-end; margin-bottom: 1rem; }
        .copy-btn { 
            padding: 0.7rem 1rem; background: #6c757d; color: white; border: none; border-radius: 4px; white-space: nowrap; font-weight: 600;
        }
        .copy-btn:hover { background: #5a6268; }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.4); backdrop-filter: blur(2px); }
        .modal-content { background-color: #fff; margin: 4% auto; padding: 2rem; border: none; width: 90%; max-width: 550px; border-radius: 8px; max-height: 85vh; overflow-y: auto; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .close { color: #aaa; float: right; font-size: 24px; font-weight: bold; cursor: pointer; line-height: 1; }
        .close:hover { color: #333; }
        
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }

.modal-title { margin: 0; font-size: 1.2rem; color: #333; }

        .form-section { background: #f8f9fa; padding: 1.5rem; border-radius: 6px; border: 1px solid #e9ecef; margin-bottom: 2rem; }
        
        /* ãƒªã‚¹ãƒˆ */
        .group-list { list-style: none; padding: 0; margin: 0; border: 1px solid #e9ecef; border-radius: 4px; }
        .group-item { padding: 1rem; border-bottom: 1px solid #e9ecef; display: flex; justify-content: space-between; align-items: center; background: white; }
        .group-item:last-child { border-bottom: none; }
        .group-name { font-weight: bold; color: #333; display: block; margin-bottom: 0.2rem; }
        .group-detail { font-size: 0.8rem; color: #6c757d; display: block; max-width: 300px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        .toast { visibility: hidden; min-width: 250px; background-color: #323232; color: #fff; text-align: center; border-radius: 4px; padding: 12px 20px; position: fixed; z-index: 2000; left: 50%; bottom: 30px; transform: translateX(-50%); font-size: 0.9rem; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .toast.show { visibility: visible; animation: fadein 0.4s, fadeout 0.4s 2.5s; }
        
        @keyframes fadein { from {bottom: 10px; opacity: 0;} to {bottom: 30px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 10px; opacity: 0;} }
    </style>

    <!-- PWA Settings -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="icon-192.png">
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js');
        }
    </script>
</head>
<body>

<div class="container">
    <h1>
        Email Group Manager
        <button class="btn-outline" onclick="openManager()">âš™ï¸ è¨­å®šç®¡ç†</button>
    </h1>
    
    <label>å®›å…ˆã‚°ãƒ«ãƒ¼ãƒ—é¸æŠ</label>
    <select id="groupSelect" onchange="loadGroup()">
        <option value="">-- ã‚°ãƒ«ãƒ¼ãƒ—ã‚’é¸æŠã—ã¦ãã ã•ã„ --</option>
    </select>

    <div class="copy-group">
        <div style="flex-grow: 1;">
            <label style="margin-top:0;">To (å®›å…ˆ)</label>
            <input type="text" id="to" readonly placeholder="ã‚°ãƒ«ãƒ¼ãƒ—ã‚’é¸æŠã™ã‚‹ã¨è¡¨ç¤ºã•ã‚Œã¾ã™">
        </div>
        <button class="copy-btn" onclick="copyToClipboard('to')">ã‚³ãƒ”ãƒ¼</button>
    </div>

    <div class="copy-group">
        <div style="flex-grow: 1;">
            <label style="margin-top:0;">Cc (åŒå ±)</label>
            <input type="text" id="cc" readonly placeholder="ã‚°ãƒ«ãƒ¼ãƒ—ã‚’é¸æŠã™ã‚‹ã¨è¡¨ç¤ºã•ã‚Œã¾ã™">
        </div>
        <button class="copy-btn" onclick="copyToClipboard('cc')">ã‚³ãƒ”ãƒ¼</button>
    </div>
</div>

<!-- ç®¡ç†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="managerModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title">ã‚°ãƒ«ãƒ¼ãƒ—è¨­å®šç®¡ç†</h2>
            <span class="close" onclick="closeManager()">&times;</span>
        </div>
        
        <div class="form-section">
            <h3 style="margin-top:0; font-size:1rem; color:#495057;">æ–°è¦ç™»éŒ² / ç·¨é›†</h3>
            <input type="hidden" id="editKey">
            
            <label>ã‚°ãƒ«ãƒ¼ãƒ—å</label>
            <input type="text" id="editLabel" placeholder="ä¾‹: é–‹ç™ºãƒãƒ¼ãƒ å®šä¾‹">
            
            <label>To (å®›å…ˆ - ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Š)</label>
            <input type="text" id="editTo" placeholder="ä¾‹: user1@example.com, user2@example.com">
            
            <label>Cc (åŒå ± - ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Š)</label>
            <input type="text" id="editCc" placeholder="ä¾‹: manager@example.com">
            
            <div style="display:flex; gap:10px; align-items:flex-end;">
                <button class="btn-primary" onclick="saveGroup()">ä¿å­˜ã™ã‚‹</button>
                <button class="btn-outline" onclick="clearForm()" style="margin-top:1rem; width:40%;">ã‚¯ãƒªã‚¢</button>
            </div>
        </div>

        <h3 style="font-size:1rem; margin-bottom:0.8rem; color:#495057;">ç™»éŒ²æ¸ˆã¿ã‚°ãƒ«ãƒ¼ãƒ—ä¸€è¦§</h3>
        <ul id="groupList" class="group-list">
            <!-- ãƒªã‚¹ãƒˆç”Ÿæˆã‚¨ãƒªã‚¢ -->
            <li class="group-item" style="justify-content:center; color:#999;">ã‚°ãƒ«ãƒ¼ãƒ—ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</li>
        </ul>
        
        <div style="margin-top:2.5rem; border-top:1px solid #e9ecef; padding-top:1.5rem;">
            <label style="margin-top:0; margin-bottom:1rem;">è¨­å®šãƒ‡ãƒ¼ã‚¿ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»å¾©å…ƒ</label>
<div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="btn-export" onclick="exportToFile()">ğŸ’¾ è¨­å®šã‚’ä¿å­˜ (Download)</button>
                <button class="btn-file" onclick="document.getElementById('fileInput').click()">ğŸ“‚ è¨­å®šã‚’èª­è¾¼ (Upload)</button>
                <input type="file" id="fileInput" accept=".json" style="display: none;" onchange="importFromFile(this)">
            </div>
            <p style="font-size:0.8rem; color:#888; margin-top:0.5rem; line-height:1.4;">
                â€» è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆJSONå½¢å¼ï¼‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã§ãã¾ã™ã€‚<br>
                â€» åˆ¥ã®ç«¯æœ«ã‚„ãƒ–ãƒ©ã‚¦ã‚¶ã§åŒã˜è¨­å®šã‚’åˆ©ç”¨ã™ã‚‹éš›ã«ä¾¿åˆ©ã§ã™ã€‚
            </p>
        </div>
    </div>
</div>

<div id="toast" class="toast">ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ</div>

<script>
    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šï¼ˆåˆå›ã®ã¿ï¼‰
    let GROUPS = {
        'sample': { label: 'ã‚µãƒ³ãƒ—ãƒ«ã‚°ãƒ«ãƒ¼ãƒ—', to: 'sample1@example.com, sample2@example.com', cc: 'manager@example.com' }
    };

    const STORAGE_KEY = 'email_group_manager_v1';

    window.onload = function() {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) {
            try {
                GROUPS = JSON.parse(saved);
            } catch(e) {
                console.error("è¨­å®šãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ", e);
            }
        }
        updateUI();
    };

    function updateUI() {
        const select = document.getElementById('groupSelect');
        const list = document.getElementById('groupList');
        const currentVal = select.value;

        // ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³æ›´æ–°
        select.innerHTML = '<option value="">-- ã‚°ãƒ«ãƒ¼ãƒ—ã‚’é¸æŠã—ã¦ãã ã•ã„ --</option>';
        list.innerHTML = '';

        const keys = Object.keys(GROUPS);

        if (keys.length === 0) {
            list.innerHTML = '<li class="group-item" style="justify-content:center; color:#999;">ã‚°ãƒ«ãƒ¼ãƒ—ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</li>';
        } else {
            keys.forEach(key => {
                const g = GROUPS[key];
                
                // ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³
                const option = document.createElement('option');
                option.value = key;
                option.textContent = g.label;
                select.appendChild(option);

                // ç®¡ç†ãƒªã‚¹ãƒˆ
                const li = document.createElement('li');
                li.className = 'group-item';
                li.innerHTML = `
                    <div class="group-info">
                        <span class="group-name">${escapeHtml(g.label)}</span>
                        <span class="group-detail">To: ${escapeHtml(g.to)}</span>
                    </div>
                    <div>
                        <button class="btn-edit" onclick="editGroup('${key}')">ç·¨é›†</button>
                        <button class="btn-danger" onclick="deleteGroup('${key}')">å‰Šé™¤</button>
                    </div>
                `;
                list.appendChild(li);
            });
        }

        // é¸æŠçŠ¶æ…‹ã®ç¶­æŒï¼ˆå­˜åœ¨ã™ã‚‹å ´åˆã®ã¿ï¼‰
        if (GROUPS[currentVal]) {
            select.value = currentVal;
        } else {
            loadGroup(); // ãƒªã‚»ãƒƒãƒˆ
        }
    }

    function loadGroup() {
        const key = document.getElementById('groupSelect').value;
        const toInput = document.getElementById('to');
        const ccInput = document.getElementById('cc');

        if (!key || !GROUPS[key]) {
            toInput.value = '';
            ccInput.value = '';
            return;
        }
        const data = GROUPS[key];
        toInput.value = data.to;
        ccInput.value = data.cc;
    }

    // --- ç®¡ç†æ©Ÿèƒ½ ---
    function openManager() { document.getElementById('managerModal').style.display = 'block'; }
    function closeManager() { document.getElementById('managerModal').style.display = 'none'; }
    
    // ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
    window.onclick = function(event) {
        const modal = document.getElementById('managerModal');
        if (event.target == modal) {
            closeManager();
        }
    }

    function saveGroup() {
        const key = document.getElementById('editKey').value || 'g_' + Date.now();

const label = document.getElementById('editLabel').value.trim();
        const to = document.getElementById('editTo').value.trim();
        const cc = document.getElementById('editCc').value.trim();

        if (!label) {
            alert('ã‚°ãƒ«ãƒ¼ãƒ—åã¯å¿…é ˆã§ã™ã€‚');
            return;
        }

        GROUPS[key] = { label, to, cc };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(GROUPS));
        
        updateUI();
        clearForm();
        showToast('è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ');
        
        // æ–°è¦ä½œæˆæ™‚ã¯ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’ä¸€ç•ªä¸‹ã¸ï¼ˆç°¡æ˜“ï¼‰
        if (!document.getElementById('editKey').value) {
            const list = document.getElementById('groupList');
            list.scrollTop = list.scrollHeight;
        }
    }

    function editGroup(key) {
        const g = GROUPS[key];
        document.getElementById('editKey').value = key;
        document.getElementById('editLabel').value = g.label;
        document.getElementById('editTo').value = g.to;
        document.getElementById('editCc').value = g.cc;
        
        // ãƒ•ã‚©ãƒ¼ãƒ ã¸ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
        document.querySelector('.form-section').scrollIntoView({ behavior: 'smooth' });
    }

    function deleteGroup(key) {
        if(confirm('ã“ã®ã‚°ãƒ«ãƒ¼ãƒ—ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) {
            delete GROUPS[key];
            localStorage.setItem(STORAGE_KEY, JSON.stringify(GROUPS));
            updateUI();
            clearForm(); // ç·¨é›†ä¸­ã ã£ãŸå ´åˆã®ãƒªã‚»ãƒƒãƒˆ
            showToast('ã‚°ãƒ«ãƒ¼ãƒ—ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
        }
    }

    function clearForm() {
        document.getElementById('editKey').value = '';
        document.getElementById('editLabel').value = '';
        document.getElementById('editTo').value = '';
        document.getElementById('editCc').value = '';
    }

    // --- ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ãƒ»èª­è¾¼ ---
    function exportToFile() {
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(GROUPS, null, 2));
        const downloadAnchorNode = document.createElement('a');
        downloadAnchorNode.setAttribute("href", dataStr);
        downloadAnchorNode.setAttribute("download", "email_groups_backup.json");
        document.body.appendChild(downloadAnchorNode);
        downloadAnchorNode.click();
        downloadAnchorNode.remove();
    }

    function importFromFile(input) {
        const file = input.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const json = JSON.parse(e.target.result);
                // ç°¡æ˜“ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
                if (typeof json !== 'object') throw new Error();

                if (confirm('ç¾åœ¨ã®è¨­å®šã‚’ä¸Šæ›¸ãã—ã¦èª­ã¿è¾¼ã¿ã¾ã™ã‹ï¼Ÿ\nï¼ˆç¾åœ¨ã®è¨­å®šã¯å¤±ã‚ã‚Œã¾ã™ï¼‰')) {
                    GROUPS = json;
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(GROUPS));
                    updateUI();
                    showToast('è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ');
                    closeManager();
                }
            } catch(err) {
                alert('ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚\næ­£ã—ã„ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«(JSON)ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
            }
        };
        reader.readAsText(file);
        input.value = ''; // ãƒªã‚»ãƒƒãƒˆ
    }

    // --- ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ---
    function copyToClipboard(id) {
        const el = document.getElementById(id);
        if(!el.value) return;
        
        el.select();
        // ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ
        el.setSelectionRange(0, 99999); 
        
        if (navigator.clipboard) {
            navigator.clipboard.writeText(el.value).then(() => {
                showToast('ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
            });
        } else {
            document.execCommand('copy');
            showToast('ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
        }
    }

    function showToast(message) {
        const toast = document.getElementById("toast");
        toast.textContent = message;
        toast.className = "toast show";
        setTimeout(() => toast.className = toast.className.replace("show", ""), 3000);
    }
    
    function escapeHtml(str) {
        if(!str) return '';

return str.replace(/[&<>"']/g, function(m) {
            return {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            }[m];
        });
    }
</script>
</body>
</html>
